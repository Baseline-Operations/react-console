name: Validate PR

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    name: Validate PR
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Check PR has description
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.pull_request.body;
            if (!body || body.trim().length === 0) {
              core.setFailed('❌ PR description is empty. Please add a description.');
            } else {
              console.log('✅ PR has description');
            }

      - name: Check for TODO/FIXME in code
        run: |
          if git diff origin/${{ github.base_ref }}...HEAD --name-only | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -l 'TODO\|FIXME' 2>/dev/null; then
            echo "⚠️  Warning: Found TODO/FIXME comments in code changes"
            echo "Consider creating issues for these items"
          else
            echo "✅ No TODO/FIXME in changed code"
          fi
        continue-on-error: true
